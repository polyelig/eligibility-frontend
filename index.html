
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eligibility Checker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f8f9fa;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    select, button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
      max-width: 300px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #summary {
      font-weight: bold;
      margin-top: 20px;
    }
    #results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      max-height: 50vh;
      overflow-y: auto;
      display: block;
    }
    #results-table th, #results-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    #results-table th {
      background-color: #007bff;
      color: white;
      position: sticky;
      top: 0;
    }
    #loader {
      display: none;
      border: 8px solid #f3f3f3;
      border-top: 8px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <select id="polytechnic"><option>-- Select Polytechnic --</option></select>
      <select id="diploma"><option>-- Select Diploma --</option></select>
      <select id="faculty"><option>-- Select Faculty --</option></select>
      <select id="programme"><option>-- Select Programme --</option></select>
    </div>
    <div class="row">
      <button onclick="checkEligibility()">Check Eligibility</button>
      <button onclick="resetSelections()">Reset</button>
    </div>
    <div id="loader"></div>
    <div id="summary"></div>
    <table id="results-table">
      <thead><tr><th>No.</th><th>Faculty</th><th>Programme</th><th>Requirements</th><th>Website</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API = "https://script.google.com/macros/s/AKfycby5Fxt2D12qrKIfnqVjb0P8zWUepSz0LDIllXig0pkoBQUmr6V6TsxoEY9uCLV6435K/exec";
    const polytechnic = document.getElementById("polytechnic");
    const diploma = document.getElementById("diploma");
    const faculty = document.getElementById("faculty");
    const programme = document.getElementById("programme");
    const loader = document.getElementById("loader");
    const summary = document.getElementById("summary");
    const tableBody = document.querySelector("#results-table tbody");

    function showLoader(show) {
      loader.style.display = show ? "block" : "none";
    }

    function fetchOptions(url, dropdown, placeholder) {
      showLoader(true);
      fetch(url)
        .then(res => res.json())
        .then(data => {
          dropdown.innerHTML = `<option>${placeholder}</option>`;
          data.forEach(item => {
            const option = document.createElement("option");
            option.value = option.textContent = item;
            dropdown.appendChild(option);
          });
          showLoader(false);
        });
    }

    function resetSelections() {
      polytechnic.selectedIndex = 0;
      diploma.selectedIndex = 0;
      faculty.selectedIndex = 0;
      programme.selectedIndex = 0;
      tableBody.innerHTML = "";
      summary.innerHTML = "";
    }

    function checkEligibility() {
      const poly = polytechnic.value;
      const dip = diploma.value;
      const fac = faculty.value;
      const prog = programme.value;

      if ([poly, dip, fac, prog].some(v => v.includes("Select"))) {
        alert("Please make all selections.");
        return;
      }

      showLoader(true);
      fetch(`${API}?action=checkEligibility&polytechnic=${poly}&faculty=${fac}&programme=${prog}`)
        .then(res => res.json())
        .then(data => {
          tableBody.innerHTML = "";
          data.forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.No}</td><td>${row.Faculty}</td><td>${row.Programme}</td><td>${row.Requirements}</td><td><a href="${row.Website}" target="_blank">Link</a></td>`;
            tableBody.appendChild(tr);
          });
          summary.innerHTML = `<strong>Polytechnic:</strong> ${poly} | <strong>Diploma:</strong> ${dip} | <strong>Faculty:</strong> ${fac} | <strong>Programme:</strong> ${prog}`;
          resetSelections();
          showLoader(false);
        });
    }

    window.onload = () => {
      fetchOptions(`${API}?action=getPolys`, polytechnic, "-- Select Polytechnic --");
      fetchOptions(`${API}?action=getFaculties`, faculty, "-- Select Faculty --");

      // Optional caching logic or event listeners
    };
  </script>
</body>
</html>
